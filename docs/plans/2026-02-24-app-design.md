# Saju App — 전체 설계 문서

> 작성일: 2026-02-24
> 작성자: 아리(Ari)
> 승인: 노아님

---

## 1. 미션 & 핵심 가설

사주팔자와 궁합을 기반으로 한 AI 소개팅 앱.
"스와이프 피로"를 겪는 MZ세대에게 **"운명적 만남"**이라는 새로운 내러티브를 제공한다.

**핵심 가설**: 사주 궁합이라는 운명적 매칭 기준이 기존 데이팅 앱의 스와이프 피로를 해결하고, 사용자에게 더 의미 있는 매칭 경험을 제공할 것이다.

**핵심 차별점**: "오행이" 캐릭터 시스템 — 앱 전체에 캐릭터가 살아 숨쉬며, 가이드/아바타/커플/커스터마이징으로 작동

**타겟 플랫폼**: iOS + Android (웹 미지원)

---

## 2. MVP 유저 플로우

```
[소셜로그인] → [온보딩 인트로 3슬라이드] → [정보입력 (캐릭터 가이드)]
     ↓
[사주 분석 (AI 해석 + 캐릭터 배정)]
     ↓
[사주 결과 카드 확인]
     ↓
[홈: 궁합 잘 맞는 사람 추천 리스트]
     ↓
[추천 카드 터치 → 궁합 프리뷰]
     ↓
[좋아요 보내기]                          ← 💰 하루 3번 무료, 초과 시 포인트
  ├── 일반 좋아요 (무료 3회/일)
  └── 프리미엄 좋아요 (항상 포인트)      ← 상대가 무료로 수락 가능
     ↓
[상대에게 알림]
     ↓
[좋아요 받은 사람이 수락/거절]            ← 💰 하루 3번 무료 수락, 초과 시 포인트
  ├── 일반 좋아요 수락 (3회/일 무료, 초과 시 포인트)
  └── 프리미엄 좋아요 수락 (무조건 무료, 횟수 차감 X)
     ↓
[매칭 성사 → 채팅방 자동 생성]
     ↓
[채팅 (캐릭터 아이스브레이커)]
```

---

## 3. 온보딩 설계

### 3.1 인트로 슬라이드 (3장, 스와이프)

**슬라이드 1: "운명이 이끈 만남"**
- 비주얼: 5캐릭터가 별자리처럼 연결된 일러스트
- 헤드라인: **너의 운명적 인연, 사주가 알고 있어**
- 서브: "4,000년 동양 지혜 × AI가 찾아주는 진짜 인연"
- 배경: 신비 모드 (먹색 + 은은한 금빛)

**슬라이드 2: "AI가 읽어주는 궁합"**
- 비주얼: 커플 캐릭터 + 궁합 점수 게이지 애니메이션
- 헤드라인: **사주로 보는 우리의 궁합**
- 서브: "오행의 상생상극, AI가 스토리로 풀어줘"
- 배경: 신비 모드 → 살짝 따뜻한 글로우

**슬라이드 3: "대화로 확인하는 운명"**
- 비주얼: 채팅 말풍선 속 두 캐릭터
- 헤드라인: **운명이 이어준 대화, 시작해볼까?**
- 서브: "스와이프 말고, 진짜 인연을 만나봐"
- 배경: 캐주얼 모드 (따뜻한 한지색) + CTA 버튼

### 3.2 정보 입력 — 토스 스타일 "한 화면 하나" (2026-02-26 갱신)

> **변경**: 기존 4스텝 폼 → 6스텝 통합 퍼널. 사주+관상을 하나의 흐름으로.

각 Step마다 **다른 캐릭터**가 등장 → 폼 입력이 아니라 캐릭터와 대화하는 느낌.
프로그레스 바: 스텝 아이콘이 하나씩 채워지는 형태.

| Step | 가이드 캐릭터 | 입력 항목 | 캐릭터 대사 예시 | 인터랙션 |
|------|-------------|-----------|----------------|----------|
| 0 | 물결이 🌊 | 이름 | "반가워! 이름이 뭐야?" | 텍스트, 버튼 활성화 |
| 1 | 쇠동이 ⚡ | 성별 | "성별을 알려줘!" | 선택, 자동진행 |
| 2 | 나무리 🌿 | 생년월일 | "생일이 언제야?" | 인라인 피커, 버튼 활성화 |
| 3 | 흙순이 🌍 | 태어난 시간 | "시간까지 알면 더 정확해져!" | 그리드, 자동진행 |
| 4 | 불꼬리 🔥 | **정면 사진 1장** | "당신의 얼굴에 어떤 동물이 숨어있을까?" | 이미지 피커, 버튼 활성화 |
| 5 | 전체 | 확인 요약 | "좋아! 이제 사주와 관상을 함께 분석해볼까?" | CTA 버튼 |

입력 완료 시 → **통합 분석 페이지** (사주+관상 순차 분석)

### 3.3 통합 분석 전환 연출 (~10초, 2026-02-26 갱신)

> **변경**: 사주 분석만 → 사주+관상 통합 분석. 사주(~3s) 완료 후 관상(~5s) 순차 실행.

1. 5캐릭터가 원형으로 배치, 빙글빙글 회전 + 오행 에너지 글로우 이펙트
2. Phase 1~5 텍스트 순환 (2초 간격):
   - "사주팔자를 풀어보고 있어요..."
   - "오행의 기운을 읽고 있어요..."
   - "당신의 관상을 분석하고 있어요..."
   - "닮은 동물상을 찾고 있어요..."
   - "운명을 정리하고 있어요..."
3. 프로그레스 바 100% → 통합 결과 페이지로 전환
4. 관상 실패 시 graceful degradation (사주 결과만으로 진행)

### 3.4 통합 결과 페이지 — TabBar [사주 | 관상] (2026-02-26 신규)

1. **공통 히어로 헤더**: 오행 캐릭터(96px) + 동물상 이모지(52px) 겹침 + "{이름}님의 운명"
2. **TabBar** 고정 (SliverPersistentHeader): [사주] | [관상]
3. **사주 탭**: 4기둥 카드, 오행 차트, 성격 칩, AI 해석
4. **관상 탭**: 동물상 리빌, 매력 키워드, 성격/연애 카드, 사주x관상 시너지, 잘 맞는 동물상
5. **하단 CTA**: "운명의 인연 찾으러 가기" → 매칭 프로필 퀵모드 → 홈

---

## 4. 캐릭터 시스템: "오행이 유니버스"

### 4.1 아바타 시스템
- 사주 분석 완료 시 주도 오행에 따라 5종 캐릭터 중 하나가 **나의 캐릭터**로 배정
- 프로필에 실사 사진 + 오행 캐릭터가 함께 표시
- 캐릭터는 사용자의 "사주 아바타" — 매칭/채팅에서 정체성 역할

### 4.2 가이드 시스템
- 온보딩: 각 Step마다 다른 캐릭터가 튜토리얼 안내
- 사주 결과: 캐릭터가 해석 설명 (말풍선 UI)
- 궁합 분석: 두 캐릭터가 대화하듯 궁합 설명
- 빈 상태(empty state): 캐릭터가 위로/격려
- 에러 상태: 캐릭터가 당황/사과

### 4.3 애니메이션 시스템
- 사주 분석 로딩: 오행 에너지 소용돌이 → 캐릭터 등장
- 매칭 성공: 두 캐릭터가 하이파이브/하트
- 궁합 등급별: 천생연분 = 불꽃 이펙트, 좋은 인연 = 꽃잎 등
- 좋아요 보내기: 캐릭터가 하트 들고 날아가는 애니메이션
- 채팅: 이모티콘 스티커로 캐릭터 활용

### 4.4 커플 캐릭터 시스템
- 매칭 시 나의 캐릭터 + 상대 캐릭터가 커플 일러스트로 합쳐짐
- 오행 조합별 고유 커플 포즈
- 궁합 점수에 따라 커플 캐릭터 분위기 달라짐

### 4.5 커스터마이징 (BM 연계)
- 기본 캐릭터는 무료
- 특별 의상/악세사리 → 💰 포인트 과금
- 시즌 한정 스킨 (설날, 크리스마스 등)

### 4.6 화면별 캐릭터 활용 맵

> **PRD 반영 (2026-02-24)**: 프로필·빈 상태·에러 상태 캐릭터 적용은 `docs/plans/2026-02-24-review-action-plan.md` 테스크 마스터로 이행. 공통 위젯 `SajuEmptyState` / `SajuErrorState` 도입.

| 화면 | 캐릭터 활용 | 디테일 |
|------|------------|--------|
| **스플래시** | 5캐릭터 모두 등장 → 흩어지며 로고 형성 | 첫인상 각인 |
| **온보딩 인트로** | 슬라이드별 캐릭터 비주얼 | 서비스 가치 전달 |
| **온보딩 입력** | Step별 다른 캐릭터 가이드 | 대화형 폼 입력 |
| **사주 분석 로딩** | 5캐릭터 회전 → 내 캐릭터 등장 | 기대감 연출 |
| **사주 결과** | 캐릭터가 결과 설명 | 오행 차트 옆 캐릭터 |
| **홈** | 내 캐릭터 인사 + 추천 카드에 상대 캐릭터 | 매일 다른 인사말 |
| **매칭 카드** | 상대 오행 캐릭터 표시 | 오행 직관적 파악 |
| **궁합 프리뷰** | 내 캐릭터 + 상대 캐릭터 나란히 | 궁합 등급별 표정 |
| **궁합 상세** | 커플 캐릭터 + 캐릭터 대화형 해석 | 💰 과금 포인트 |
| **좋아요 보내기** | 하트 들고 날아가는 애니메이션 | 즐거운 인터랙션 |
| **좋아요 수신** | "누가 날 좋아한대!" 두근두근 | 알림 화면 |
| **매칭 성사** | 두 캐릭터 하이파이브/하트 | 축하 애니메이션 |
| **채팅** | 상대 캐릭터 프로필 아이콘 + 스티커 | 이모티콘 활용 |
| **프로필** | 내 캐릭터 커스터마이징 미리보기 | 의상/악세사리 착용 |
| **빈 상태** | 캐릭터 위로/격려 | "아직 매칭이 없어.. 기다려!" |
| **에러 상태** | 캐릭터 당황/사과 | "앗, 다시 해볼까?" |
| **결제 화면** | 아이템 착용 미리보기 | 구매 욕구 자극 |

### 4.7 캐릭터 에셋 구조 (2026-02-27 갱신)

```
assets/images/characters/
├── {character}/
│   ├── default.png          ← 기본 (앱 전역 사용)
│   ├── expressions/         ← 표정별 개별 이미지
│   │   ├── default.png, laugh.png, love.png, sad.png, ...
│   ├── poses/              ← 포즈별 개별 이미지
│   │   ├── standing.png, sitting.png, waving.png, ...
│   └── views/              ← 방향별 (정면/측면/후면)
│       ├── front.png, side.png, back.png
```

**캐릭터 목록** (8종):
namuri(나무리/木), namuri_girlfriend(나무리 여친), bulkkori(불꼬리/火), heuksuni(흙순이/土), soedongi(쇠동이/金), mulgyeori(물결이/水), gold_tokki(황금토끼), black_tokki(검은토끼)

**코드 접근**:
```dart
CharacterAssets.namuri.expression('love')   // 하트눈
CharacterAssets.soedongi.pose('sitting')    // 앉기
CharacterAssets.pathFor(FiveElementType.water).view('front')  // 물결이 정면
```

**에셋 관리 규칙**:
- 원본 스프라이트 시트 → connected component analysis로 개별 PNG 자동 분리
- 배경 제거(누끼): rembg 사용, 텍스트 포함 시 "흰색 덮기 → 누끼" 방식
- 네이밍: `{romanized_name}/{variant}/{descriptor}.png`
- 총 103개 개별 파일 (2026-02-27 기준)

---

## 5. BM 구조: 포인트 기반 개별과금

### 5.1 과금 테이블

| 과금 포인트 | 무료 범위 | 포인트 | 비고 |
|------------|-----------|--------|------|
| **좋아요 보내기** | 하루 3회 | 초과 시 100P/건 | 핵심 수익원 1 |
| **프리미엄 좋아요** | 없음 | 300P/건 | 상대가 무료+횟수차감 없이 수락 가능 |
| **좋아요 수락** | 하루 3회 | 초과 시 100P/건 | 핵심 수익원 2 |
| **상세 궁합 리포트** | 없음 | 500P/건 | AI 상세 분석 + 스토리 |
| **사주 상세 리포트** | 기본 1회 무료 | 500P/건 | 연애운/직업운/건강운 |
| **캐릭터 스킨** | 기본 캐릭터 무료 | 200~500P/건 | 의상, 악세사리, 시즌 한정 |
| **아이스브레이커** | 없음 | 100P/건 | 궁합 기반 대화 주제 5개 |

### 5.2 포인트 패키지

| 패키지 | 가격 | 포인트 | 보너스 |
|--------|------|--------|--------|
| 스타터 | ₩1,900 | 200P | — |
| 베이직 | ₩4,900 | 600P | +100P |
| 프리미엄 | ₩9,900 | 1,400P | +400P |
| VIP | ₩19,900 | 3,000P | +1,000P |

### 5.3 무료 범위 (리텐션 설계)
- 사주 기본 분석 1회
- 매일 궁합 추천 리스트 (무제한 열람)
- 궁합 프리뷰 (간단 점수 + 등급)
- 좋아요 보내기 3회/일
- 좋아요 수락 3회/일
- 기본 캐릭터 + 채팅

---

## 6. 홈 화면 구성

```
┌─────────────────────────────────┐
│  🌿 나무리  안녕, [이름]님!      │  ← 내 캐릭터 인사 (매일 다른 인사말)
│  "오늘의 운명적 인연을 찾아봐~"   │  ← 캐릭터 말풍선
├─────────────────────────────────┤
│                                 │
│  ✨ 오늘의 추천 매칭              │
│  ┌─────────┐  ┌─────────┐      │
│  │ [사진]   │  │ [사진]   │     │  ← 가로 스크롤 카드
│  │ 🔥84점   │  │ 🌊78점   │     │     상대 오행 캐릭터 + 궁합 점수
│  │ 불꼬리♥  │  │ 물결이♥  │     │
│  └─────────┘  └─────────┘      │
│                                 │
├─────────────────────────────────┤
│  💕 나를 좋아한 사람 (3명)       │  ← 프리미엄 좋아요는 ✨ 표시
│  ┌──────────────────────┐      │
│  │ 🔒 블러 / 캐릭터만 보임│     │  ← 수락 전에는 캐릭터만 보임
│  └──────────────────────┘      │
├─────────────────────────────────┤
│  📊 오늘의 사주 한마디           │  ← 일일 포춘 (캐릭터 안내)
│  "목 기운이 강한 오늘,           │
│   새로운 만남에 열려있으면 좋겠어" │
│           — 나무리 🌿           │
└─────────────────────────────────┘
│  🏠   💕   💬   👤              │  ← 하단 탭
```

---

## 7. 컴포넌트 디자인 시스템 (HeroUI 참고)

### 7.1 설계 원칙

HeroUI의 Compound Component 패턴 + 일관된 Size/Variant/Color 시스템을 Flutter에 적용.

**사이즈 시스템**:
```dart
enum SajuSize { xs, sm, md, lg, xl }
// 모든 컴포넌트가 동일한 사이즈 enum 공유
```

**배리언트 시스템**:
```dart
enum SajuVariant { filled, outlined, flat, elevated, ghost }
// 일관된 스타일 변형
```

**오행 컬러 시맨틱**:
```dart
enum SajuColor { wood, fire, earth, metal, water, primary, secondary }
// 오행 컬러가 1급 시민으로 동작
```

### 7.2 컴포넌트 목록

**기본 컴포넌트 (Atoms)**:

| 컴포넌트 | 설명 | 특징 |
|----------|------|------|
| `SajuButton` | 주요 액션 버튼 | 5 variants, 5 sizes, 오행 컬러 |
| `SajuChip` | 태그/필터 칩 | 관심사, 성향, 오행 태그 |
| `SajuAvatar` | 프로필 이미지 + 캐릭터 | 실사+캐릭터 오버레이 |
| `SajuBadge` | 알림/상태 뱃지 | 궁합 등급, 새 메시지 |
| `SajuInput` | 텍스트 입력 | 한지 스타일 |

**합성 컴포넌트 (Molecules)**:

| 컴포넌트 | 설명 | 특징 |
|----------|------|------|
| `SajuCard` | 범용 카드 | Header/Content/Footer 구조 |
| `SajuMatchCard` | 매칭 추천 카드 | 사진+캐릭터+궁합+오행태그 |
| `SajuCompatibilityCard` | 궁합 결과 카드 | 점수 게이지+커플 캐릭터+등급 |
| `SajuProfileCard` | 사주 프로필 카드 | 오행 분포 차트+캐릭터+성향 |
| `SajuCharacterBubble` | 캐릭터 말풍선 | 가이드/해석 표시 |

**페이지 컴포넌트 (Organisms)**:

| 컴포넌트 | 설명 | 특징 |
|----------|------|------|
| `SajuBottomNav` | 하단 네비게이션 | 4탭 + 캐릭터 아이콘 |
| `FiveElementChart` | 오행 분포 차트 | 레이더/바 차트 |
| `CompatibilityGauge` | 궁합 점수 게이지 | 원형 프로그레스 + 등급 |
| `CharacterCouple` | 커플 캐릭터 위젯 | 두 캐릭터 조합 렌더링 |
| `SajuPillarDisplay` | 사주팔자 4기둥 표시 | 천간+지지 카드 4개 |

### 7.3 듀얼 무드 시스템

- **캐주얼 무드** (라이트): 홈, 프로필, 채팅 — 따뜻하고 친근한 한지 톤
- **신비 무드** (다크): 사주 분석, 궁합, 매칭 결과 — 신비로운 먹색 + 금빛 글로우
- 컨텍스트 기반 자동 전환 (단순 테마 토글 아님)

---

## 8. 데이터 아키텍처

### 8.1 DB 스키마

```
┌─────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   profiles   │────▶│  saju_profiles   │     │  daily_matches  │
│  (유저 기본)  │     │  (사주 데이터)    │     │  (매일 추천)     │
└──────┬───────┘     └────────┬─────────┘     └────────┬────────┘
       │                      │                         │
       │              ┌───────▼──────────┐              │
       │              │ saju_compatibility│◀─────────────┘
       │              │  (궁합 결과 캐시) │
       │              └──────────────────┘
       │
       ├──────▶┌──────────────┐     ┌──────────────────┐
       │       │    likes      │────▶│    matches       │
       │       │  (좋아요)     │     │  (매칭 성사)      │
       │       └──────────────┘     └───────┬──────────┘
       │                                     │
       │       ┌──────────────┐     ┌───────▼──────────┐
       ├──────▶│   blocks     │     │   chat_rooms     │
       │       │  (차단)       │     │  (채팅방)         │
       │       └──────────────┘     └───────┬──────────┘
       │                                     │
       │       ┌──────────────┐     ┌───────▼──────────┐
       ├──────▶│   reports    │     │  chat_messages   │
       │       │  (신고)       │     │  (메시지)         │
       │       └──────────────┘     └──────────────────┘
       │
       ├──────▶┌──────────────┐
       │       │  user_points │
       │       │  (포인트 잔액)│
       │       └──────────────┘
       │
       ├──────▶┌───────────────────┐
       │       │ point_transactions │
       │       │  (포인트 거래내역) │
       │       └───────────────────┘
       │
       ├──────▶┌──────────────┐
       │       │  daily_usage │
       │       │  (일일 사용량) │
       │       └──────────────┘
       │
       ├──────▶┌──────────────┐
       │       │  purchases   │
       │       │  (IAP 구매)   │
       │       └──────────────┘
       │
       └──────▶┌──────────────────┐
               │ character_items   │
               │ (캐릭터 커스터마이징)│
               └──────────────────┘
```

### 8.2 주요 테이블 설계

**profiles**
- `id`, `auth_id`, `name`, `birth_date`, `birth_time`, `gender`
- `profile_images[]`, `bio`, `interests[]`, `height`, `location`, `occupation`
- `dominant_element`, `character_type` (배정된 캐릭터)
- `point_balance` (빠른 조회용 캐시)
- `created_at`, `last_active_at`, `deleted_at`

**saju_profiles**
- `id`, `user_id` (FK→profiles)
- `year_pillar`, `month_pillar`, `day_pillar`, `hour_pillar` (각 천간+지지)
- `five_elements` (JSONB: {wood, fire, earth, metal, water})
- `dominant_element`, `personality_traits[]`
- `ai_interpretation` (Claude AI 해석 텍스트)
- `is_lunar_calendar`, `calculated_at`

**saju_compatibility** (한 번 계산하면 캐시)
- `id`, `user_id`, `partner_id` (unique pair)
- `total_score`, `five_element_score`, `day_pillar_score`
- `overall_analysis`, `strengths[]`, `challenges[]`, `advice`
- `ai_story` (AI 생성 로맨틱 스토리)
- `is_detailed` (상세 리포트 구매 여부)
- `calculated_at`

**likes**
- `id`, `sender_id`, `receiver_id`
- `is_premium` (프리미엄 좋아요 여부)
- `status` (enum: pending, accepted, rejected, expired)
- `sent_at`, `responded_at`

**matches**
- `id`, `user1_id`, `user2_id`
- `like_id` (FK→likes)
- `compatibility_id` (FK→saju_compatibility)
- `matched_at`, `unmatched_at`

**user_points**
- `id`, `user_id`
- `balance`, `total_earned`, `total_spent`
- `updated_at`

**point_transactions**
- `id`, `user_id`
- `type` (enum: purchase, like_sent, premium_like_sent, accept, compatibility_report, character_skin, saju_report, icebreaker, daily_reset_bonus)
- `amount` (+충전, -사용)
- `target_id` (관련 좋아요/매칭 ID)
- `created_at`

**daily_usage**
- `id`, `user_id`, `date`
- `free_likes_used` (기본값 0, 최대 3)
- `free_accepts_used` (기본값 0, 최대 3)

**character_items**
- `id`, `user_id`, `item_type` (outfit, accessory, background)
- `item_id`, `is_equipped`
- `purchased_at`

### 8.3 Edge Functions

| 함수 | 역할 | 트리거 |
|------|------|--------|
| `calculate-saju` | 생년월일시 → 사주팔자 계산 | 온보딩 완료 시 |
| `generate-saju-insight` | Claude API로 사주 AI 해석 | 사주 계산 직후 |
| `calculate-compatibility` | 두 사용자 궁합 계산 | 매칭 카드 터치 시 |
| `generate-match-story` | Claude API로 궁합 스토리 생성 | 상세 궁합 구매 시 |
| `get-daily-matches` | 궁합 기반 추천 리스트 생성 | 매일 자정 (cron) |
| `send-like` | 좋아요 전송 | 무료 잔여 체크 → 포인트 차감 → 알림 |
| `accept-like` | 좋아요 수락 | 프리미엄 여부 체크 → 처리 → 매칭+채팅방 생성 |
| `purchase-points` | RevenueCat webhook → 포인트 충전 | 결제 완료 시 |
| `reset-daily-usage` | 무료 사용량 초기화 | 매일 자정 (cron) |

### 8.4 RLS (Row Level Security)

- 자기 프로필만 수정 가능
- 매칭된 상대의 프로필만 조회 가능 (추천 리스트는 서버사이드)
- 채팅은 해당 채팅방 참여자만 접근
- 궁합 결과는 당사자 둘만 접근
- 포인트/구매 내역은 본인만 접근
- 좋아요는 sender/receiver만 접근

---

## 9. 기술 아키텍처

### 9.1 Feature-First Clean Architecture

```
lib/
├── app/                    # 앱 진입점, 라우팅, DI
├── core/                   # 공유 유틸, 상수, 테마, 에러
│   ├── constants/
│   ├── errors/
│   ├── network/
│   ├── theme/
│   ├── widgets/            # SajuButton, SajuCard 등 디자인 시스템 컴포넌트
│   └── utils/
├── features/
│   ├── auth/               # 인증 (소셜 로그인)
│   ├── onboarding/         # 온보딩 (인트로 + 정보입력)
│   ├── saju/               # 사주 분석 (계산, AI 해석, 결과)
│   ├── matching/           # 매칭 (추천, 좋아요, 수락)
│   ├── compatibility/      # 궁합 (프리뷰, 상세 리포트)
│   ├── chat/               # 채팅
│   ├── profile/            # 프로필 관리
│   ├── character/          # 캐릭터 (아바타, 커스터마이징)
│   ├── points/             # 포인트 (잔액, 충전, 내역)
│   └── home/               # 홈 (추천 리스트, 알림, 일일 포춘)
└── main.dart
```

### 9.2 각 Feature 내부 구조

```
feature/
├── data/
│   ├── datasources/        # Remote/Local 데이터 소스
│   ├── models/             # DTO (API ↔ Entity 변환)
│   └── repositories/       # Repository 구현체
├── domain/
│   ├── entities/           # 비즈니스 엔티티
│   ├── repositories/       # Repository 인터페이스 (abstract)
│   └── usecases/           # 유즈케이스
└── presentation/
    ├── pages/              # 화면
    ├── providers/          # Riverpod providers
    └── widgets/            # 재사용 위젯
```

### 9.3 의존성 규칙
- **domain**: 순수 Dart, 외부 의존 없음
- **data**: domain에만 의존
- **presentation**: domain에만 의존
- **presentation → data 직접 참조 절대 금지**

---

## 10. 개발 접근법: B+C 하이브리드

유저 플로우 순서대로, 각 단계를 Vertical Slice로 완성.

### Phase 1: 기반 (이미 완료)
- [x] 디자인 시스템 (한지 팔레트, 테마)
- [x] 도메인 엔티티 (User, Saju, Compatibility)
- [x] 라우팅 구조
- [x] 에러 처리, 유틸, 상수
- [x] 캐릭터 에셋

### Phase 2: 디자인 시스템 컴포넌트
- [ ] SajuButton, SajuChip, SajuAvatar 등 Atom 컴포넌트
- [ ] SajuCard, SajuMatchCard 등 Molecule 컴포넌트
- [ ] 듀얼 무드 시스템 구현

### Phase 3: Auth + 온보딩
- [ ] 소셜 로그인 (Apple, Google)
- [ ] 인트로 3슬라이드 (캐릭터 비주얼)
- [ ] 정보 입력 4단계 (캐릭터 가이드)
- [ ] Supabase Auth 연동

### Phase 4: 사주 분석
- [ ] 사주 계산 (manseryeok-js 기반)
- [ ] AI 해석 (Claude API Edge Function)
- [ ] 사주 결과 화면 + 캐릭터 배정
- [ ] 분석 로딩 애니메이션

### Phase 5: 매칭 + 궁합
- [ ] 홈 화면 (추천 리스트 + 캐릭터 인사)
- [ ] 매칭 카드 UI
- [ ] 궁합 프리뷰 / 상세 리포트
- [ ] 좋아요 / 프리미엄 좋아요 / 수락 시스템
- [ ] 포인트 시스템 + 충전

### Phase 6: 채팅
- [ ] Supabase Realtime 기반 1:1 채팅
- [ ] 매칭 성사 → 채팅방 자동 생성
- [ ] 캐릭터 아이스브레이커

### Phase 7: 프로필 + 캐릭터 커스터마이징
- [ ] 프로필 편집
- [ ] 캐릭터 스킨/악세사리 상점
- [ ] 포인트 결제 (RevenueCat)

---

## 11. 차별화 전략 요약

| 요소 | 기존 데이팅 앱 | 사주인연 |
|------|--------------|---------|
| 매칭 기준 | 외모/스와이프 | 사주 궁합 (운명적 서사) |
| 캐릭터 | 없음 | 오행이 캐릭터가 앱 전체 관통 |
| 온보딩 | 지루한 폼 | 캐릭터 가이드 대화형 |
| 프로필 | 사진 중심 | 사진 + 사주 프로필 카드 + 캐릭터 |
| 궁합 | 알고리즘 블랙박스 | AI 스토리텔링 + 오행 해석 |
| BM | 구독 중심 | 포인트 개별과금 (좋아요/수락/리포트/스킨) |
| 빈 상태 | 기계적 메시지 | 캐릭터가 위로/격려 |
| 로딩 | 스피너 | 캐릭터 애니메이션 연출 |

---

## 12. 다음 할 일 / 백로그 (2026-02-27 갱신)

**다른 디바이스에서 연속 작업 시**: 우선 **테스크 마스터**를 확인하세요.

| 문서 | 용도 |
|------|------|
| **테스크 마스터** | `docs/plans/2026-02-24-task-master.md` — 다음에 할 일 우선순위·담당·상태 |
| dev-log | `docs/dev-log/2026-02-24-progress.md` — 완료 내역, 레슨런, 아키텍처 현황 |
| CLAUDE.md | 개발자룰·아키텍처·연속 작업 규칙 |

**최근 완료 (2026-02-27):**
- 캐릭터 에셋 체계화 (C1~C6) — 누끼 재작업, 스프라이트 분리(103개), 폴더 구조화, CharacterPath 헬퍼

**이전 완료 (2026-02-26):**
- 통합 사주+관상 온보딩 플로우 (D1~D6) — 하나의 퍼널, 탭 결과
- 토스 UX 리팩토링 (U1~U6) — 한 화면 하나 + 햅틱 + 스켈레톤
- 온보딩 리팩토링 (R1~R9) — 12단계→6단계, 관상 홈 넛지 분리

**요약 (상세는 테스크 마스터 참조)**
- 즉시: daily_matches 실데이터, 궁합 프리뷰 실사용 검증
- 단기: 궁합 규칙집·상세 리포트, 십신 보강, 받은 좋아요/프로필 편집 페이지
- 중기: Phase 7 Chat, Phase 8 Payment, Supabase 실연동
- 장기: 궁합 가중치 A/B, 푸시 알림, 바이럴·분석
