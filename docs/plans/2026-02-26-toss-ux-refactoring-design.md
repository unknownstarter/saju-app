# 토스 스타일 UX 리팩토링 설계서

> **작성일**: 2026-02-26
> **작성자**: 시니어 PD + PM + Flutter Dev (아리)
> **목적**: 현재 "양식 작성" 느낌의 입력 UX를 토스 수준의 "대화형 한 화면 하나" 경험으로 전면 리팩토링
> **참조**: 3-에이전트 UX 분석 결과, Apple HIG, Material Design 3

---

## 0. 현황 진단 요약

| 영역 | 현재 점수 | 핵심 문제 |
|------|----------|----------|
| **입력 경험** | 5.5/10 | "양식 작성"처럼 느껴짐. 한 화면에 3-6개 필드 |
| **결과 경험** | 8.5/10 | 사주·관상 결과는 연출·디자인 수준급 |
| **인터랙션** | 5.5/10 | 햅틱 0, 버튼 비활성 상태 없음, 인라인 검증 부족 |
| **로딩 경험** | 6/10 | 스피너만 있음, 스켈레톤 없음 |
| **퍼널 예상 완주율** | 20-35% | 사진 업로드(35-45%), 소셜 로그인(20-40%) 이탈 |

**PD 핵심 한마디**: "결과 화면은 수준급인데, 거기까지 가는 과정이 '양식 작성'이다."

---

## 1. 설계 원칙 — "토스 3원칙"

### 1-1. 한 화면에 하나의 질문 (One Question Per Screen)
- 모든 입력 화면을 **단일 질문**으로 분리
- 질문이 명확해야 유저가 0.5초 안에 "아, 이걸 입력하면 되는구나" 판단 가능
- 캐릭터 버블이 질문을 자연어로 안내 ("이름이 뭐야~?")

### 1-2. 즉시 반응 (Instant Feedback)
- 입력 완료 즉시 **자동 진행** (선택형) 또는 **버튼 활성화** (텍스트형)
- 모든 인터랙션에 **햅틱 피드백** (selectionClick, lightImpact)
- 에러는 **인라인** (SnackBar 금지, 필드 아래 빨간 텍스트 + 흔들림)

### 1-3. 진행감 (Sense of Progress)
- 상단 **리니어 프로그레스바** (0%→100%, 연속적 애니메이션)
- 캐릭터가 스텝마다 변경 (이미 구현됨 ✅)
- 완료 시 **축하 연출** (햅틱 + 텍스트 바운스)

---

## 2. 온보딩 폼 리팩토링 (Phase A: 사주 기본 정보)

### BEFORE (2 스텝)
```
Step 1: 이름 + 성별 + 생년월일  ← 3개 필드, 양식 느낌
Step 2: 생시(12시진) 선택
```

### AFTER (5 스텝 — 한 화면 하나)
```
Step 1: 이름        ← 키보드 auto-focus, Enter로 자동 진행
Step 2: 성별        ← 칩 탭 즉시 자동 진행 (0.3초 딜레이)
Step 3: 생년월일     ← 날짜 피커, 확인 탭 즉시 자동 진행
Step 4: 생시        ← 12시진 그리드, 탭 즉시 자동 진행
Step 5: 확인        ← 입력 요약 + "사주 분석하기" CTA
```

### 스텝별 상세 설계

#### Step 1: 이름
- **캐릭터**: 물결이(水) — "반가워! 이름이 뭐야~?"
- **입력**: SajuInput (auto-focus, maxLength: 20)
- **버튼**: "다음" (2자 이상 입력 시 활성화)
- **진행**: Enter 키 또는 버튼 탭
- **검증**: 2자 미만 → 인라인 에러 "이름은 2자 이상이어야 해요"
- **햅틱**: 버튼 활성화 시 `selectionClick()`

#### Step 2: 성별
- **캐릭터**: 물결이(水) — "{이름}님, 성별을 알려줘!"
- **입력**: SajuChip ×2 (남성/여성), 가로 중앙 배치
- **진행**: 칩 탭 → 0.3초 대기(선택 확인 연출) → 자동 진행
- **햅틱**: 칩 탭 시 `selectionClick()`, 자동 진행 시 `lightImpact()`

#### Step 3: 생년월일
- **캐릭터**: 물결이(水) — "태어난 날짜를 알려줘~"
- **입력**: 인라인 날짜 피커 (CupertinoDatePicker, 바텀시트 아님!)
  - 화면 하단 50%에 피커 표시
  - 상단에 선택된 날짜 실시간 미리보기 ("2000년 3월 15일")
- **버튼**: "이 날짜가 맞아요" (피커 조작 후 활성화)
- **진행**: 버튼 탭
- **햅틱**: 피커 스크롤 시 `selectionClick()`, 확인 시 `lightImpact()`

#### Step 4: 생시 (12시진)
- **캐릭터**: 쇠동이(金) — "태어난 시간대를 골라줘~"
- **입력**: 시진 그리드 (3×4, 현재와 동일하되 크기 확대)
  - "모르겠어요" 옵션 하단 별도 배치
- **진행**: 칩 탭 → 0.3초 대기 → 자동 진행
- **햅틱**: 칩 탭 시 `selectionClick()`, 자동 진행 시 `lightImpact()`

#### Step 5: 입력 확인 + 사주 분석 시작
- **캐릭터**: 물결이(水) — "좋아! 이제 사주를 분석해볼까?"
- **표시**: 입력된 정보 요약 카드
  - 이름, 성별, 생년월일, 생시 (각각 아이콘 + 텍스트)
  - 각 항목 탭 → 해당 스텝으로 돌아가기
- **버튼**: "사주 분석하기" (filled, xl, auto_awesome icon)
- **햅틱**: 분석 시작 시 `mediumImpact()`

### 프로그레스바
- 5스텝 기준 0→20→40→60→80→100%
- `AnimatedContainer` with `SajuAnimation.slow` (300ms)
- 색상: 현재 캐릭터 오행 색 (물결이=수색, 쇠동이=금색)

---

## 3. 매칭 프로필 리팩토링

### BEFORE
```
퀵 모드: 2스텝 (사진 6슬롯 + 기본정보 3필드)
풀 모드: 5스텝 (사진 + 기본정보 + 자기표현 + 라이프스타일 + 인증)
```

### AFTER (퀵 모드: 4스텝, 풀 모드: 10스텝)
```
퀵 모드:
  Step 1: 사진 1장 (정면)      ← 카메라/갤러리 즉시 실행
  Step 2: 키                    ← 숫자 키보드 auto-focus
  Step 3: 직업                  ← 텍스트 키보드 auto-focus
  Step 4: 지역                  ← 칩 탭 자동 진행

풀 모드:
  Step 1-4: (퀵과 동일)
  Step 5: 사진 추가 (최대 5장 더) ← 선택사항, 스킵 가능
  Step 6: 자기소개              ← 텍스트 영역
  Step 7: MBTI                  ← 칩 그리드 탭 자동 진행
  Step 8: 관심사                ← 멀티 선택 칩 + 커스텀
  Step 9: 라이프스타일          ← 음주·흡연·종교 각각 칩 그리드
  Step 10: 본인인증             ← 셀카
```

### 핵심 변경

#### 사진 업로드 간소화 (퀵 모드)
- 6슬롯 그리드 → **1장 풀스크린 프리뷰**
- 즉시 카메라/갤러리 선택지 표시
- 촬영 후 크롭 → 미리보기 → "이 사진으로 할게요!" 버튼
- 캐릭터: "첫인상이 중요해! 정면 사진 1장이면 충분해~"

#### 텍스트 입력 (키, 직업)
- 한 화면에 하나만
- auto-focus로 키보드 즉시 표시
- Enter 또는 "다음" 버튼으로 진행
- 키: 숫자 키보드 (`keyboardType: TextInputType.number`)
- 직업: 일반 키보드 + 추천 칩 ("학생", "직장인", "자영업", "프리랜서")

#### 지역 선택
- 한 화면 전체에 지역 칩 그리드
- 탭 → 0.3초 대기 → 자동 진행
- 상단: "어디 살아~?" 캐릭터 버블

---

## 4. 글로벌 인터랙션 시스템

### 4-1. 햅틱 피드백 서비스

```dart
/// lib/core/services/haptic_service.dart
class HapticService {
  /// 칩/옵션 선택 시
  static void selection() => HapticFeedback.selectionClick();

  /// 버튼 탭, 자동 진행 시
  static void light() => HapticFeedback.lightImpact();

  /// CTA 탭, 중요 액션 시
  static void medium() => HapticFeedback.mediumImpact();

  /// 에러 발생 시
  static void error() => HapticFeedback.heavyImpact();

  /// 성공/축하 시
  static void success() => HapticFeedback.lightImpact();
}
```

### 4-2. 자동 진행 패턴 (선택형 입력)

```dart
/// 칩 탭 → 선택 연출 → 자동 다음 화면
void _onOptionSelected(String value) {
  setState(() => _selectedValue = value);
  HapticService.selection();

  // 0.3초 대기 (선택 확인 연출)
  Future.delayed(const Duration(milliseconds: 300), () {
    HapticService.light();
    _goToNextStep();
  });
}
```

### 4-3. 버튼 활성화 패턴 (텍스트형 입력)

```dart
/// 입력값이 유효하면 버튼 활성화 + 햅틱
bool get _isCurrentStepValid => switch (_currentStep) {
  0 => _nameController.text.trim().length >= 2,
  1 => _selectedGender != null,
  // ...
};

// 버튼
SajuButton(
  label: '다음',
  onPressed: _isCurrentStepValid ? _goToNextStep : null,
  // onPressed가 null이면 자동으로 비활성 스타일
)
```

### 4-4. 인라인 에러 패턴

```dart
/// SnackBar 대신 필드 아래 에러 텍스트 + 흔들림 애니메이션
SajuInput(
  errorText: _showError ? '이름은 2자 이상이어야 해요' : null,
  // errorText가 있으면 빨간색 텍스트 + 필드 테두리 빨간색
)
```

에러 발생 시 추가 연출:
- 필드 1회 좌우 흔들림 (shake animation, 400ms)
- 햅틱: `HapticService.error()`
- 에러 텍스트 fadeIn (200ms)

### 4-5. 스텝 전환 애니메이션

현재 PageView `animateToPage` (350ms easeInOut) → **유지** (이미 적절)

추가:
- 새 스텝 진입 시 컨텐츠 **슬라이드업 + 페이드인** (200ms)
- 캐릭터 버블 **타이핑 → 메시지** 연출 (이미 SajuCharacterBubble에 구현됨 ✅)

---

## 5. 홈 페이지 로딩 개선

### 5-1. 스켈레톤 로딩

현재 `CircularProgressIndicator` → **스켈레톤 카드**로 교체

```
스켈레톤 카드 (180×260):
┌─────────────────┐
│ ░░░░░░░░░░░░░░░ │ ← 사진 영역 (shimmer)
│ ░░░░░░░░░░░░░░░ │
│                 │
│ ░░░░░░░░        │ ← 이름 (짧은 바)
│ ░░░░░░░░░░░░    │ ← 나이·지역 (중간 바)
│ ░░░░░ ░░░░░░    │ ← 궁합 점수 (두 개 바)
└─────────────────┘
```

- `shimmer` 패키지 사용 (또는 커스텀 AnimatedBuilder)
- 2개 카드 나란히 (실제 데이터와 동일 레이아웃)
- 로딩 완료 시 페이드 전환

### 5-2. 홈 섹션 등장 애니메이션

- 각 섹션 **스크롤 진입 시** 슬라이드업 + 페이드인
- `VisibilityDetector` 또는 `SliverAnimatedList` 활용
- 한 번만 실행 (재스크롤 시 애니메이션 안 함)

---

## 6. 구현 우선순위

### Phase A: 코어 인프라 (1일)
1. `HapticService` 생성
2. `SajuButton` 비활성 시각 상태 강화 (opacity + color)
3. `SajuInput` 에러 시 흔들림 애니메이션 추가

### Phase B: 온보딩 폼 리팩토링 (1일)
4. 온보딩 2스텝 → 5스텝 (한 화면 하나)
5. 생년월일 인라인 피커
6. 자동 진행 패턴 적용
7. 입력 확인 요약 스텝

### Phase C: 매칭 프로필 리팩토링 (1일)
8. 퀵 모드 사진 풀스크린
9. 텍스트 입력 개별 화면 분리
10. 지역 선택 자동 진행

### Phase D: 홈 + 폴리싱 (0.5일)
11. 홈 스켈레톤 로딩
12. 홈 섹션 등장 애니메이션
13. 통합 검증

---

## 7. 수정 대상 파일 목록

| 파일 | 변경 내용 | 규모 |
|------|----------|------|
| `lib/core/services/haptic_service.dart` | **신규** — 햅틱 피드백 서비스 | 소 |
| `lib/core/widgets/saju_button.dart` | 비활성 시각 상태 강화 | 소 |
| `lib/core/widgets/saju_input.dart` | 에러 시 흔들림 애니메이션 | 중 |
| `lib/features/auth/presentation/pages/onboarding_form_page.dart` | **전면 리팩토링** 2→5스텝 | 대 |
| `lib/features/profile/presentation/pages/matching_profile_page.dart` | 퀵 모드 4스텝, 풀 모드 10스텝 | 대 |
| `lib/features/home/presentation/pages/home_page.dart` | 스켈레톤 + 등장 애니메이션 | 중 |
| `lib/core/widgets/skeleton_card.dart` | **신규** — 스켈레톤 로딩 위젯 | 소 |

---

## 8. 성공 지표

| 메트릭 | 현재 추정 | 목표 |
|--------|----------|------|
| 온보딩 완주율 | 20-35% | 50%+ |
| 사진 업로드 이탈 | 35-45% | 15-20% |
| 입력 경험 점수 (PD) | 5.5/10 | 8/10+ |
| 인터랙션 품질 (Dev) | 55/100 | 85/100 |
| 평균 온보딩 시간 | ~7분 | ~2분 |

---

## 9. 설계 결정 근거

### Q: 왜 5스텝으로 늘리는 게 더 좋은가?
- **Toss/뱅크샐러드 검증**: 화면당 필드 수 ↓ → 이탈률 ↓, 전환율 ↑
- 유저가 "이건 10초면 답할 수 있겠다" → 심리적 부담 최소화
- 선택형 입력(성별, 시진)은 **자동 진행**으로 체감 스텝 수 감소
- 실제 체감: 5스텝이지만 자동 진행 3개 → 사실상 **2번만 직접 탭**

### Q: 자동 진행 딜레이가 왜 0.3초인가?
- < 0.2초: 선택 확인 못 느낌 → "내가 뭘 선택했지?"
- 0.3초: 선택 피드백 인지 + 자연스러운 전환
- > 0.5초: 느리게 느껴짐 → "왜 안 넘어가지?"
- 토스 결제 플로우 참고 (약 250-350ms)

### Q: SnackBar를 왜 전면 금지하는가?
- SnackBar는 화면 하단에 잠깐 뜨고 사라짐 → 놓치기 쉬움
- 인라인 에러는 **원인(필드) 바로 옆에** 표시 → 즉시 인지
- 흔들림 애니메이션으로 시각적 주의 끌기
- 접근성: 스크린리더가 필드 에러를 자연스럽게 읽음
